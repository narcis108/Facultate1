{% load static %}
<!DOCTYPE html>
<html>
<!DOCTYPE html>
<html lang="en">

<head>
    <title>League of Films</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="media/images/favicon.png">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/app.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href='//fonts.googleapis.com/css?family=Kotta+One' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800,800italic'
          rel='stylesheet' type='text/css'>
    <link href="{% static 'css/style.css' %}" rel="stylesheet" type="text/css" media="all"/>
    <script src="{% static 'js/jquery-3.2.1.min.js' %}"></script>
    <script src="{% static 'js/jquery.seat-charts.js' %}"></script>
<body>

<!--Navigation bar-->
<div class="top">
    <!--Navigation bar-ul pe ecrane normale-->
    <div class="bar" id="nSticky">
        <a class="bar-item button hover-black hide-medium hide-large right" href="javascript:void(0);"
           onclick="toggle()"><i class="fa fa-bars"></i></a>


        <a href="#" class="bar-item button text-white"><i class="fa fa-home"></i> ACASĂ</a>
        <a href="#movies" class="bar-item button hide-small text-white"><i class="fa fa-film"></i> FILME</a>
        <a href="#tickets" class="bar-item button hide-small text-white"><i class="fa fa-ticket"></i> REZERVARE</a>
        <a href="#contact" class="bar-item button hide-small text-white"><i class="fa fa-envelope"></i> CONTACT</a>
        {% if user.is_authenticated %}
            <a href="{% url 'myAccount' %}" class="bar-item button hide-small text-white right"><i
                    class="fa fa-user-circle-o"></i> {{ user.username }}</a>

        {% else %}
            <form class="form-inline ml-auto">
                <a href="{% url 'login' %}" class="bar-item button hide-small text-white right"><i
                        class="fa fa-sign-in"></i> LOGARE</a>
                <a href="{% url 'signup' %}" class="bar-item button hide-small text-white right"><i class="fa fa-user"
                                                                                                    aria-hidden="true"></i>
                    INREGISTRARE</a>
            </form>
        {% endif %}
    </div>

    <!--Navigation bar-ul pe ecrane mici-->
    <div id="mSticky" class="bar-block black hide hide-large hide-medium">
        <a href="#movies" class="bar-item button" onclick="toggle()"><i class="fa fa-film"></i> FILME</a>
        <a href="#tickets" class="bar-item button" onclick="toggle()"><i class="fa fa-ticket"></i> REZERVARE</a>
        <a href="#contact" class="bar-item button" onclick="toggle()"><i class="fa fa-envelope"></i> CONTACT</a>
        <a href="#" class="bar-item button"><i class="fa fa-search"></i> CAUTARE</a>
    </div>
</div>

<!--Prima pagina/Prima imagine-->
<div class="bgimg-1 display-container" id="home">
    <div class="display-middle" style="white-space:nowrap;">
        <span class="center padding-large black xlarge wide animate-opacity hide-small">LEAGUE OF FILMS</span>
        <span class="center padding-large black xlarge wide animate-opacity hide-medium hide-large">L O F</span>
    </div>
</div>

<!--Sectiunea cu filme -->
<div class="content container padding-64" id="movies">
    <h3 class="center">Filme</h3>
    <p class="center"><em><b>Interval {{ luni|date:"d/m/Y" }} - {{ duminica|date:"d/m/Y" }}</b></em></p><br>

    <!--Movie grid-->
    <div class="row-padding center section">
        {% for film in filme %}
            <div class="col m3" id="{{ film.link_Youtube }}" title="{{ film.data_lansare }}" onclick="divOnClick(this)"
                 about="{{ film.pk }}">
                <img src="{{ film.imagine }}" style="width:75%" class="hover-opacity" onclick="onClick(this)"
                     alt="{{ film.titlu }}" title="{{ film.descriere }}" name="{{ film.link_IMDB }}"
                     id="{{ film.rating }}">
            </div>
        {% endfor %}
    </div>


</div>

<!--Modal cu detalii-->

<div id="modal" class="modal card-4" onclick="this.style.display='none'"
     style="position: fixed;width: 100%; height: 100%;">
    <div class="modal-content animate-bottom"
         style="background-color: rgba(0,0,0,0.9); width: 100%; bottom:0; position: fixed">
        <div class="container">
                <span class="display-topright text-white padding hover-text-red" title="Close"><i
                        class="fa fa-remove"></i></span>


            <div class="row">
                <div class="col container hide-small hide-medium" style="width:185px">
                    <img id="image" class="image display-topleft margin" style="height: 90%">
                </div>

                <div class="rest container">
                    <div class="half justify">
                        <a id="link_titlu"><h1 id="caption"
                                               class="large margin text-white"></h1>
                        </a>
                        <p id="descriere"></p>
                        <a id="link_IMDB" class="large margin text-white" href="{{ current_film.link_IMDB }}"><i
                                class="fa fa-imdb">IMDB</i></a>
                        <a class="large margin text-white"><i
                                class="fa fa-star-o">
                            <small id="rating"></small>
                        </i></a>
                        <a class="large margin text-white"><i
                                class="fa fa-calendar-o"><p id="data_lansare"></p></i></a>

                    </div>
                    <div class="half hide-small center">
                        <iframe height="250" width="80%" id="link_Youtube"
                                src="" frameborder="0"
                                allowfullscreen></iframe>
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>


<!--Rezervare-->
<div class="bgimg-2 display-container">
    <div class="display-middle">
        <span class="xxlarge text-white wide">REZERVARE</span>
    </div>
</div>
<!-- Container (About Section) -->
{% if user.is_authenticated %}
    <div class="container" id="tickets">
        <div class="main">
            <h2>League of Films : Sala Cinema</h2>
            <form method="post" action="{% url 'process_film' 1 %}">
                <div class="demo">
                    {% csrf_token %}
                    <div id="seat-map">
                        <div class="front">ECRAN</div>
                    </div>
                    <div class="booking-details">
                        <ul class="book-left">
                            <li>Film</li>
                            <li>Perioada</li>
                            <li>Bilete</li>
                            <li>Total</li>
                            <li>Scaune :</li>
                        </ul>
                        <ul class="book-right">
                            <li>: {{ current_film.titlu }}</li>
                            <li>: <select name="data">
                                {% for data in interval_data %}
                                    <option value="{{ data|date:"d/m/Y" }}">{{ data|date:"d/m/Y" }}</option>
                                {% endfor %}
                            </select>
                                <input type="hidden" name="ora"></li>
                            <li>: <span id="counter">0</span></li>
                            <li>: <b><span id="total">0</span><i> LEI</i></b></li>
                        </ul>
                        <div class="clear"></div>
                        <ul id="selected-seats" class="scrollbar scrollbar1"></ul>


                        <button type="button" class="checkout-button" id="rezerva" name="rezerva">Rezerva</button>
                        <div id="legend"></div>
                    </div>
                    <div style="clear:both"></div>
            </form>
        </div>

        <script type="text/javascript">
            var URL = "{% url 'process_film' 1 %}"
            var price = 10; //price
            $(document).ready(function () {
                var $cart = $('#selected-seats'), //Sitting Area
                    $counter = $('#counter'), //Votes
                    $total = $('#total'); //Total money
                var sc = $('#seat-map').seatCharts({
                    map: [  //Seating chart
                        'aaaaaaaaaa',
                        'aaaaaaaaaa',
                        '__________',
                        'aaaaaaaaaa',
                        'aaaaaaaaaa',
                        'aaaaaaaaaa',
                        'aaaaaaaaaa',
                        'aaaaaaaaaa',
                        'aaaaaaaaaa',
                        'aaaaaaaaaa'
                    ],
                    naming: {
                        top: false,
                        getLabel: function (character, row, column) {
                            return column;
                        }
                    },
                    legend: { //Definition legend
                        node: $('#legend'),
                        items: [
                            ['a', 'available', 'Disponibil'],
                            ['a', 'unavailable', 'Indisponibil'],
                            ['a', 'selected', 'Selectat']
                        ]
                    },
                    click: function () { //Click event
                        if (this.status() == 'available') { //optional seat
                            $('<li>Randul ' + (this.settings.row + 1) + ' Scaunul ' + this.settings.label + '</li>')
                                .attr('id', 'cart-item-' + this.settings.id)
                                .data('seatId', this.settings.id)
                                .appendTo($cart);

                            $counter.text(sc.find('selected').length + 1);
                            $total.text(recalculateTotal(sc) + price);
                            return 'selected';
                        } else if (this.status() == 'selected') { //Checked
                            //Update Number
                            $counter.text(sc.find('selected').length - 1);
                            //update totalnum
                            $total.text(recalculateTotal(sc) - price);

                            //Delete reservation
                            $('#cart-item-' + this.settings.id).remove();
                            //optional
                            return 'available';
                        } else if (this.status() == 'unavailable') { //sold
                            return 'unavailable';
                        } else {
                            return this.style();
                        }
                    }
                });

                //sold seat
                actualizeaza(sc);
                $('select[name=data]').change(function () {
                    actualizeaza(sc);
                    reset_counter(sc);
                })
            });

            function actualizeaza(sc) {

                var sala_goala = [];
                for (var row = 1; row <= 10; row++)
                    for (var column = 1; column <= 10; column++)
                        if (row != 3)
                            sala_goala.push(row.toString().concat("_").concat(column.toString()))
                for (var loc = 0; loc <= sala_goala.length; loc++) {
                    sc.get(sala_goala[loc]).status('available');
                }
                var data = $('select[name=data]').val();
                $.ajax({
                    url: '{% url 'afiseaza_locuri'%}',
                    data: {
                        'data': data,
                        'film_pk': {{ current_film.pk }}
                    },
                    dataType: 'json',
                    success: function (locuri) {
                        if (locuri.locuri_ocupate.length) {
                            for (var loc = 0; loc <= locuri.locuri_ocupate.length; loc++) {
                                sc.get(locuri.locuri_ocupate[loc]).status('unavailable');
                            }
                        } else {
                            for (var loc = 0; loc <= sala_goala.length; loc++) {
                                sc.get(sala_goala[loc]).status('available');
                            }
                        }

                    }
                })
            }

            function reset_counter(sc){
                var $counter = $('#counter'),
                    $total = $('#total');
                 $counter.text('0');
                 $total.text('0');
            }

            //sum total money
            function recalculateTotal(sc) {
                var total = 0;
                sc.find('selected').each(function () {
                    total += price;
                });

                return total;
            }

            $('#rezerva').click(function () {
                var $cart = $('li[id^="cart-item-"]');
                var loc_selectat = JSON.stringify($cart);
                var data = $('select[name=data]').val();
                $.ajax({
                    url: '{% url 'validare' %}',
                    data: {
                        'loc_selectat': loc_selectat,
                        'utilizator': "{{ user }}",
                        'film_pk': "{{ current_film.pk }}",
                        'data': data
                    },
                    dataType: 'json',
                    success: function (data) {
                        if (data.succes) {
                            alert('Succes! Vei fi redirectionat catre pagina principala!')
                            window.location.replace("{% url 'home' %} ");
                        }
                        else {
                            alert('Nu e bine, boule!')
                        }
                    }
                });
            });

            $('#link_titlu').click(function () {
                var captionText = document.getElementById("caption").innerHTML;
                $.ajax({
                    url: '{% url 'redirecteaza'%}',
                    data: {
                        'titlu': captionText
                    },
                    dataType: 'json',
                    success: function (data) {
                        if (data.gasit) {
                            console.log(data.gasit);
                            console.log(typeof(data.gasit));
                            window.location.replace("http://127.0.0.1:8000/rezervare/".concat(data.gasit).concat("/#tickets"));
                        }

                    }

                })
            })

        </script>
    </div>
{% else %}
    <div class="container">
        <h1 class="center">Te rugam sa te autentifici si sa alegi un film pentru a face o rezervare</h1>
    </div>
{% endif %}

<!--Contact-->
<div class="bgimg-3 display-container">
    <div class="display-middle">
        <span class="xxlarge text-white wide">CONTACT</span>
    </div>
</div>

<!--Harta, adresă, email-->
<div class="content container padding-64" id="contact">
    <h3 class="center">Unde ne gasiți?</h3>
    <div class="row padding-32 section">
        <div class="col m4 container">
            <div id="googleMap" class="round-large green" style="width:100%;height:400px;"></div>
        </div>
        <div class="col m8 panel">
            <div class="large margin-bottom">
                <i class="fa fa-map-marker fa-fw hover-text-black xlarge margin-right"></i> Galați, RO<br>
                <i class="fa fa-phone fa-fw hover-text-black xlarge margin-right"></i> Telefon: +40 0778889990<br>
                <i class="fa fa-envelope fa-fw hover-text-black xlarge margin-right"></i> Email:
                leagueoffilms@yahoo.com<br>
            </div>
            <p>Doriți să raportați ceva sau doriți să ne transmiteți un mesaj?</p>
            <form action="{% url 'mesaj_contact' %}" method="GET">
                <div class="row-padding" style="margin:0 -16px 10px -16px">
                    <div class="half">
                        <input class="input border" type="text" placeholder="Numele și prenumele" required
                               name="nume_complet">
                    </div>
                    <div class="half">
                        <input class="input border" type="text" placeholder="Email" required name="email">
                    </div>
                </div>
                <input class="input border" type="text" placeholder="Mesajul dumneavostră" required name="message">
                <button class="button black right section" type="submit"><i class="fa fa-paper-plane"></i> Trimite
                    mesaj
                </button>
            </form>
        </div>
    </div>
</div>
<!--Footer-->
<footer class="center black padding">
    <a href="#home" class=" right"><i class="fa fa-arrow-circle-up"></i></a>
    <div class="xlarge section">
        <i class="fa fa-envelope hover-opacity padding"></i>
        <i class="fa fa-facebook-official hover-opacity padding"></i>
        <i class="fa fa-twitter hover-opacity padding"></i>
        <i class="fa fa-bell hover-opacity padding"></i>
    </div>
</footer>
<script src="{% static 'script/index.js' %}"></script>
<script src="{% static 'js/jquery.nicescroll.js' %}"></script>
<script src="{% static 'js/scripts.js' %}"></script>
</body>
</html>
